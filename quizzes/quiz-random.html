<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AI Quiz - Smart Learning System</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-blue-900 text-white py-6 shadow">
    <div class="container mx-auto flex justify-between items-center px-6">
      <h1 class="text-2xl font-bold">English Adjuster</h1>
      <nav>
        <a href="../index.html" class="mr-4 hover:text-yellow-300">Home</a>
        <a href="../lessons/lessons.html" class="mr-4 hover:text-yellow-300">Lessons</a>
        <a href="quiz.html" class="mr-4 hover:text-yellow-300">Quizzes</a>
        <a href="../profile.html" class="text-3xl text-yellow-300">üë§</a>
      </nav>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container mx-auto px-6 py-12 flex-grow">
    <section class="text-center mb-10">
      <h2 class="text-4xl font-bold text-blue-900 mb-3">AI-Powered Random Quiz</h2>
      <p class="text-lg text-gray-700">Click below to generate a grammar quiz using AI!</p>
    </section>

    <!-- Quiz Box -->
    <div id="question-box" class="bg-white p-6 rounded-lg shadow border border-gray-200 max-w-3xl mx-auto mb-6 text-left">
      <p class="text-gray-600">Waiting for AI question...</p>
    </div>

    <!-- Button -->
    <div class="text-center">
      <button onclick="generateQuiz()" class="bg-blue-700 hover:bg-blue-900 text-white font-bold py-2 px-6 rounded">
        Generate Question
      </button>
    </div>
    <pre id="quiz-output" style="white-space: pre-wrap; margin-top: 1rem;"></pre>

    <script>
  // 1Ô∏è‚É£  Auto-detect backend URL
  const BACKEND_URL =
    window.location.hostname.includes("github.io")
      ? "https://english-adjuster-v1.onrender.com" // Render backend
      : "http://localhost:5500";                   // Local dev	
	  
    async function generateQuiz() {
      const box = document.getElementById("question-box");
      box.innerHTML = "<p class='text-gray-600'>Loading quiz...</p>";

      try {
        
		// const res = await fetch("http://localhost:5500/generate-quiz", {
		
		const res = await fetch(`${BACKEND_URL}/generate-quiz`, {		
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            prompt: "Generate 1 easy grammar multiple-choice question in JSON format like: {question:'...', options:[...], answer:'...'}"
          })
        });

        const data = await res.json();
        const quiz = typeof data.quiz === "string" ? JSON.parse(data.quiz) : data.quiz;

        // ‡∏™‡∏°‡∏°‡∏∏‡∏ï‡∏¥‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà 1 ‡∏Ç‡πâ‡∏≠
        const q = Array.isArray(quiz) ? quiz[0] : quiz;

        box.innerHTML = `
          <div class="mb-6">
            <h3 class="font-semibold text-lg mb-4">${q.question}</h3>
            <div id="options">
              ${q.options.map((opt, i) => `
                <button
                  onclick="checkAnswer(this, '${opt}', '${q.answer}')"
                  class="block w-full text-left bg-gray-100 hover:bg-gray-200 px-4 py-2 mb-2 rounded"
                >
                  (${String.fromCharCode(65 + i)}) ${opt}
                </button>
              `).join("")}
            </div>
            <div id="feedback" class="mt-4 text-lg font-semibold"></div>
          </div>
        `;
      } catch (err) {
        console.error("Error generating quiz:", err);
        box.innerHTML = "<p class='text-red-500'>Failed to load quiz.</p>";
      }
    }

    // ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö
    function checkAnswer(button, selected, correct) {
      const feedback = document.getElementById("feedback");

      // Disable all buttons
      const allButtons = document.querySelectorAll("#options button");
      allButtons.forEach(btn => {
        btn.disabled = true;
        btn.classList.remove("bg-gray-100", "hover:bg-gray-200");
        btn.classList.add("opacity-50");
      });

      if (selected === correct) {
        feedback.innerHTML = "‚úÖ ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!";
        button.classList.add("bg-green-200");
      } else {
        feedback.innerHTML = `‚ùå ‡∏ú‡∏¥‡∏î ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏∑‡∏≠ "${correct}"`;
        button.classList.add("bg-red-200");
      }
    }
    </script>

  </main>

  <!-- Footer -->
  <footer class="bg-blue-900 text-white text-center py-4">
    <p>&copy; 2025 Smart Learning System. All rights reserved.</p>
  </footer>
  <button onclick="window.history.back()"class="fixed top-4 left-4 text-white text-2xl hover:text-yellow-300 font-bold py-2 px-4 z-50 ">
    ‚á¶
  </button>

</body>
</html>
